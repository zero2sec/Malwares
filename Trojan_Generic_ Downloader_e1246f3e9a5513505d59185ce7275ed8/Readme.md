# Trojan Generic Downloader e1246f3e9a5513505d59185ce7275ed8

    Este malware foi identificado no Brasil, primeira identificação ocorreu no dia 2017-03-23 15:39:29 UTC
    This malware sample was identified in Brazil, first identified in 2017-03-23 15:39:29 UTC

**Password Sample** 

	infected

**Phishing - O Metodo de distribuição**

O metodo utilizado pelo invasor foi Phishing, por ser um metodo fácil de atingir as vitimas e ter uma assertividade de infecção alta.

**Assunto:** URGENTE - Pagamento Aprovado

**Mensagem:**

![alt tag](https://github.com/zero2sec/Malwares/blob/master/Trojan_Generic_%20Downloader_e1246f3e9a5513505d59185ce7275ed8/images/01.PNG) 

**Header da Mensagem**
	
Nome | Valor
--------- | ------
Authentication-Results     | spf=softfail (sender IP is 52.169.249.0)
Message-ID    | <20170322174443.4EF3D20C57@cnakjn.cnakjn.f9.internal.cloudapp.net>

**Endereço do Link**

	https://www.alltrackcomercial.com.br/wp-content/themes/twentythirteen/NF-Eletr%C3%B4nicaDigital.rar

**Dados do Malware**

Nome | Informação
--------- | ------
Arquivo     | NF-EletrônicaDigital.exe
Arquitetura    | 32 bits
**Descrição**    | PE32 executable (GUI) Intel 80386, for MS Windows
**Tipo do Arquivo**    | Portable Executable 32
**Compilador/Packer**    | Borland Delphi 4.0
**MD5**    | e1246f3e9a5513505d59185ce7275ed8
**SHA1**   | 166fa07fd3b4616c78b3c944e8afa431fa35dbfa
**SHA256** | 9155cd3576c4478669ccf5b2cdbcb298269d9dbbb23dea10ff5c2fe45eae47de

# Relatório do Virus Total e Reverse.it

**Reverse.it Report**

	https://www.reverse.it/sample/9155cd3576c4478669ccf5b2cdbcb298269d9dbbb23dea10ff5c2fe45eae47de?environmentId=100


**Virus Total Report**

	https://www.virustotal.com/en/file/9155cd3576c4478669ccf5b2cdbcb298269d9dbbb23dea10ff5c2fe45eae47de/analysis/


Antivirus  | Result | Update
--------- | ------ | ------ 
AegisLab |	Troj.W32.Generic!c |	20170323 
AhnLab-V3 |	Malware/Gen.Generic.C1065579 |	20170323 
Avast |	Win32:Malware-gen |	20170323 
ESET-NOD32 | 	a variant of Win32/TrojanDownloader.Banload.XWL |	20170323 
Kaspersky |	HEUR:Trojan.Win32.Generic |	20170323 
McAfee |	Artemis!E1246F3E9A55 |	20170323 
McAfee-GW-Edition |	BehavesLike.Win32.Dropper.vh |	20170323 
Qihoo-360 |	HEUR/QVM05.1.0000.Malware.Gen 	| 20170323 
Rising |	Downloader.Banload!8.15B (cloud:lLNQQk0clXI) |	20170323 
Symantec |	Trojan.Gen.8!cloud |	20170322 
ZoneAlarm by Check Point |	HEUR:Trojan.Win32.Generic |	20170323 
Ad-Aware |	-|	20170323 
Alibaba |	-|	20170323 
ALYac| 	-	|20170323 
Antiy-AVL |	-	|20170323 
Arcabit |	-	|20170323 
AVG |	-|	20170323 
Avira (no cloud) |	-|	20170323 
AVware |	-|	20170323 
Baidu |	-	|20170323 
BitDefender |	-	|20170323 
Bkav |	-|	20170323 
CAT-QuickHeal| 	-|	20170322 
ClamAV |	-	|20170323 
CMC |	-|	20170317 
Comodo |	-|	20170323 
CrowdStrike Falcon (ML) |	-	|20170130 
Cyren 	|-|	20170323 
DrWeb 	|-|	20170323 
Emsisoft |	-|	20170323 
Endgame |	-|	20170317 
F-Prot |	-	|20170323 
F-Secure |	-|	20170323 
Fortinet |	-|	20170323 
GData |	-	|20170323 
Ikarus |	-|	20170323 
Invincea |	-|	20170203 
Jiangmin |	-|	20170323 
K7AntiVirus |	-|	20170323 
K7GW |	-|	20170323 
Kingsoft |	-|	20170323 
Malwarebytes |	-|	20170323 
Microsoft |	-|	20170323 
eScan 	|-	|20170323 
NANO-Antivirus 	|-|	20170323 
nProtect 	|-|	20170323 
Palo Alto Networks (Known Signatures) |	-|	20170323 
Panda |	-	|20170323 
SentinelOne (Static ML) |	-|	20170315 
Sophos |	-|	20170323 
SUPERAntiSpyware |	-|	20170323 
Symantec Mobile Insight |	-|	20170322 
Tencent 	|-	|20170323 
TheHacker |	-	|20170321 
TotalDefense |	-|	20170323 
TrendMicro |	-|	20170323 
TrendMicro-HouseCall |	-|	20170323 
Trustlook |	-|	20170323 
VBA32 	|-|	20170323 
VIPRE |	-|	20170323 
ViRobot 	|-	|20170323 
Webroot 	|-|	20170323 
WhiteArmor 	|-|	20170315 
Yandex |	-|	20170323 
Zillya |	-|	20170323 
Zoner 	|-|	20170323 

# Assinatura do Arquivo

O arquivo é assinado com o formato MZ que comprova ser um arquivo executável de acordo com as evidencias coletadas

	https://www.filesignatures.net/index.php?search=4d5a&mode=SIG



Ao abrir o arquivo utilizando uma ferramenta de descompressão para visualizar o conteúdo e coletar o hash de cada arquivo

Name	| MD5
--------- | ------ 
CODE	| bf1ab5182781e827032b19f963a452f9
DATA	| 6e11fa3743e593485902b8239b4cf7a9
BSS	| d41d8cd98f00b204e9800998ecf8427e
.idata	| cacd6aebe71a1b43281ac3d6dd806ecb
.tls	| d41d8cd98f00b204e9800998ecf8427e
.rdata	| 71e8af33bff325e10d974ce81dc7f019
.reloc	| 7c091a09aa5830255d6b75dc0e829608
.rsrc	| 05b391e1f0c70f96adf330c3f04220b7

![alt tag](https://github.com/zero2sec/Malwares/blob/master/Trojan_Generic_%20Downloader_e1246f3e9a5513505d59185ce7275ed8/images/02.PNG) 

Ao abrir o arquivo utilizando uma ferramenta de descompressão para visualizar o conteúdo e coletar o hash de cada arquivo

![alt tag](https://github.com/zero2sec/Malwares/blob/master/Trojan_Generic_%20Downloader_e1246f3e9a5513505d59185ce7275ed8/images/03.PNG) 

Na análise podemos identificar a plataforma que o Malware foi construído e as requisições que serão realizadas no processo de execução.

![alt tag](https://github.com/zero2sec/Malwares/blob/master/Trojan_Generic_%20Downloader_e1246f3e9a5513505d59185ce7275ed8/images/04.PNG) 

![alt tag](https://github.com/zero2sec/Malwares/blob/master/Trojan_Generic_%20Downloader_e1246f3e9a5513505d59185ce7275ed8/images/05.PNG) 

# Conexões de Rede

O executável realiza diversas conexões remota com a intenção de baixar novos arquivos e fazer conexões DNS com a intenção de demonstrar a existência do equipamento afetado para o invasor


Endereço	|
--------- |
http://componentace.com	| 
http://2k17.com.br/2/index.php	| 
http://www.componentace.com	| 
http://mode.g3pro.com.br/gingtoolz0.zip	| 
104.31.83.168:80	|
104.27.147.215:80		| 

![alt tag](https://github.com/zero2sec/Malwares/blob/master/Trojan_Generic_%20Downloader_e1246f3e9a5513505d59185ce7275ed8/images/06.PNG) 

![alt tag](https://github.com/zero2sec/Malwares/blob/master/Trojan_Generic_%20Downloader_e1246f3e9a5513505d59185ce7275ed8/images/07.PNG) 

![alt tag](https://github.com/zero2sec/Malwares/blob/master/Trojan_Generic_%20Downloader_e1246f3e9a5513505d59185ce7275ed8/images/08.PNG) 

![alt tag](https://github.com/zero2sec/Malwares/blob/master/Trojan_Generic_%20Downloader_e1246f3e9a5513505d59185ce7275ed8/images/09.PNG) 

![alt tag](https://github.com/zero2sec/Malwares/blob/master/Trojan_Generic_%20Downloader_e1246f3e9a5513505d59185ce7275ed8/images/10.PNG) 

![alt tag](https://github.com/zero2sec/Malwares/blob/master/Trojan_Generic_%20Downloader_e1246f3e9a5513505d59185ce7275ed8/images/11.PNG) 

# Registro, Diretórios, Processos e Arquivos
 
# Registro
O arquivo realiza adições e modificações nas chaves de registro.

----------------------------------
**Values added:3**
----------------------------------

Endereço	|
--------- |
HKU\S-1-5-21-1220945662-1677128483-1343024091-500\Software\Microsoft\Windows\CurrentVersion\Explorer\UserAssist\{75048700-EF1F-11D0-9888-006097DEACF9}\Count\HRZR_EHACNGU:P:\Qbphzragf naq Frggvatf\Nqzvavfgenqbe\Zrhf qbphzragbf\Qbjaybnqf\AS-RyrgeôavpnQvtvgny.rkr: 10 00 00 00 06 00 00 00 D0 CD 94 A3 FC A3 D2 01	| 
HKU\S-1-5-21-1220945662-1677128483-1343024091-500\Software\Microsoft\Windows\ShellNoRoam\MUICache\C:\Documents and Settings\Administrador\Meus documentos\Downloads\NF-EletrônicaDigital.exe: "NF-EletrônicaDigital"	| 
HKU\S-1-5-21-1220945662-1677128483-1343024091-500\Software\Microsoft\Windows\ShellNoRoam\MUICache\C:\Documents and Settings\Administrador\Configurações locais\Dados de aplicativos\Alo3ky7\FalowDiver2.exe: "FalowDiver2"
 
----------------------------------
**Values modified:4**
----------------------------------

Endereço	|
--------- |
HKLM\SOFTWARE\Microsoft\Cryptography\RNG\Seed: BF 68 32 84 06 15 21 37 C2 FD E6 BB 95 64 7E B8 ED 19 AF 34 43 B0 1D 10 96 DE E2 CA 4B A4 DA 88 BB C0 1D 7E 01 93 05 6B D6 87 7A CB 17 B4 55 74 34 A6 6F D4 6C CF 62 0F B6 91 BD 9E 11 A5 4A 81 04 75 56 F1 4A E1 BD E8 C5 8B 04 71 E3 4D 25 C2	| 
HKLM\SOFTWARE\Microsoft\Cryptography\RNG\Seed: 0F B2 03 C9 D0 F6 62 C7 76 1B C4 A0 18 D3 66 14 FA 97 90 4D 97 9F A2 45 57 FA 4C 3E 2E E8 E2 FB 10 41 43 1A E4 5E CB 74 09 AA 28 4B F4 EA CD 92 9E B4 50 DA 97 3A BB F3 4C 23 54 0B BC A5 10 0D 2C BD 0C B2 2F 41 B2 76 AB 64 FC 63 C0 21 40 D9	| 
HKU\S-1-5-21-1220945662-1677128483-1343024091-500\Software\Microsoft\Windows\CurrentVersion\Explorer\UserAssist\{75048700-EF1F-11D0-9888-006097DEACF9}\Count\HRZR_EHACNGU: 10 00 00 00 36 00 00 00 A0 5D 49 9E FC A3 D2 01	| 
HKU\S-1-5-21-1220945662-1677128483-1343024091-500\Software\Microsoft\Windows\CurrentVersion\Explorer\UserAssist\{75048700-EF1F-11D0-9888-006097DEACF9}\Count\HRZR_EHACNGU: 10 00 00 00 37 00 00 00 D0 CD 94 A3 FC A3 D2 01	| 
HKU\S-1-5-21-1220945662-1677128483-1343024091-500\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Connections\SavedLegacySettings: 3C 00 00 00 16 00 00 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00	|
HKU\S-1-5-21-1220945662-1677128483-1343024091-500\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Connections\SavedLegacySettings: 3C 00 00 00 17 00 00 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 |
HKU\S-1-5-21-1220945662-1677128483-1343024091-500\SessionInformation\ProgramCount: 0x00000002 | 
HKU\S-1-5-21-1220945662-1677128483-1343024091-500\SessionInformation\ProgramCount: 0x00000003 |
 
----------------------------------
**Total changes:7**
----------------------------------

# Processos
Mesmo sendo outro arquivo executado, quem fica responsável em execução no equipamento é o arquivo **FalowDrive0.exe** que é responsável pelas execuções maliciosas no equipamento.

![alt tag](https://github.com/zero2sec/Malwares/blob/master/Trojan_Generic_%20Downloader_e1246f3e9a5513505d59185ce7275ed8/images/12.PNG) 

![alt tag](https://github.com/zero2sec/Malwares/blob/master/Trojan_Generic_%20Downloader_e1246f3e9a5513505d59185ce7275ed8/images/13.PNG) 

# Arquivos
Com a execução, o arquivo cria diversos diretórios e arquivos dentro do sistema operacional.

![alt tag](https://github.com/zero2sec/Malwares/blob/master/Trojan_Generic_%20Downloader_e1246f3e9a5513505d59185ce7275ed8/images/14.PNG)

![alt tag](https://github.com/zero2sec/Malwares/blob/master/Trojan_Generic_%20Downloader_e1246f3e9a5513505d59185ce7275ed8/images/15.PNG)

No endereço abaixo estão os arquivos responsável para download dos novos malwares que irão infectar o equipamento.

NF-EletrônicaDigital.exe	3104	CreateFile	C:\Documents and Settings\Administrador\Cookies\
administrador@g3pro.com[1].txt

![alt tag](https://github.com/zero2sec/Malwares/blob/master/Trojan_Generic_%20Downloader_e1246f3e9a5513505d59185ce7275ed8/images/16.PNG)


**administrador@2k17.com[1].txt**	|
--------- |
__cfduid
d2c42ccbeeba89aaea62dba7e148ddc4f1490360182
2k17.com.br/
9728
2187337472
30655343
2315518224
30581756| 

**administrador@g3pro.com[1].txt**	|
--------- |
__cfduid
da0124b4c1c59e569254af211502980001490360149
g3pro.com.br/
9728
1857337472
30655343
1972528224
30581756 | 


**Index.dat**	|
--------- |
 Client UrlCache MMF Ver 5.2
HASH 
URL 
Cookie:administrador@g3pro.com.br/
administrador@g3pro.com[1].txt
URL 
Cookie:administrador@2k17.com.br/
administrador@2k17.com[1].txt
| 

 

# Diretórios 

Levantamos os arquivos e diretórios criados pelo malware.

C:\Documents and Settings\Administrador\Configurações locais\Temporary Internet Files\Content.IE5\CJEFY567\GINGtoolz0[1].zip

C:\Documents and Settings\Administrador\Configurações locais\Dados de aplicativos\Alo3ky7\IALIB3463467P21

URL arquivo: http://Mode.g3pro.com.br/GINGtoolz0.zip

![alt tag](https://github.com/zero2sec/Malwares/blob/master/Trojan_Generic_%20Downloader_e1246f3e9a5513505d59185ce7275ed8/images/17.PNG)

Malwares e scripts encapsulados no arquivo **IALIB3463467P21**

![alt tag](https://github.com/zero2sec/Malwares/blob/master/Trojan_Generic_%20Downloader_e1246f3e9a5513505d59185ce7275ed8/images/18.PNG)

**IALIB3463467P21**	|
--------- |
 MD5 4f613606b5a0ed57c63dc51a097ed9cd | 
 SHA1 ec8caf38e8723cecedb142616b2a1b89bbf72942 | 
 SHA256 8ae2ece6805b761f216493b92fef4404a93f3fee10cbe5384d003dbcc14e51b3 | 


**FalowDiver2.dat**	|
--------- |
 MD5 6f0791a3ae4a8b82c7800ec52cac19fd | 
 SHA1 4f862b6f7e92c19f3ebc1684a0c8e8089f688064 | 
 SHA256 568ca499efdc87360aaabea40861d3f2461af8d069b8ff988a0306d023504d12 | 
	

**FalowDiver2.exe**	|
--------- |
 MD5 d694a8e2171f6496752de9089160b5f4 | 
 SHA1 cad5ef6d7ce70272502543ce355342ce60b9b74d | 
 SHA256 7a5573248f02f5e13780b4213343f9394874af9380fae9bcbc5251a7267d2f26 | 	
	
 
**FalowDiver2.LM**	|
--------- |
 MD5 6ea946397f35f3c3cbc32a684cf3d0c9| 
 SHA1 6034f7c29ccf0a9042dc00657e1ae9272b0a7550 | 
 SHA256 19898a39af2bf799c2d905fb39d00249de8ab5872429747ec45b9dcf1eb34a0f| 	


**FalowDiver0.exe**	|
--------- |
 MD5 999e2d18f5369911215b627795ad16cf| 
 SHA1 be945aa2d95a33d12a743d9ba4179403ae0195c9| 
 SHA256 0ed20264479af2d0fa4c1f19aaffc30a70c410b2fd8050806977c7fd02d86ce2|


**GINGtoolz0[1].zip**	|
--------- |
 MD5 7b667958373928cdc8188489226d8e25| 
 SHA1 f4e22c342ab2c8b5b71144627a8f174b04972c3d| 
 SHA256 36cb91d5e4e6ed739526da602d50f28b9c8029f1d6d285d29f435a87b9782cc0|

# Análise de Memória
Durante o processo de análise de memória detectamos a execução do arquivo WWW_GetWindowInfo.exe que assume o papel de levantamento as informações do equipamento como HW, SW, Diretórios, Usuários, etc.

![alt tag](https://github.com/zero2sec/Malwares/blob/master/Trojan_Generic_%20Downloader_e1246f3e9a5513505d59185ce7275ed8/images/19.PNG)


Separamos alguns endereços de memória:


Address	| Lenght | Result
--------- | --------- | --------- |
0x10000 | (102) | ALLUSERSPROFILE=C:\Documents and Settings\All Users |
0x10068 | (136) | APPDATA=C:\Documents and Settings\Administrador\Dados de aplicativos|
0x10118 | (118) |CommonProgramFiles=C:\Arquivos de programas\Arquivos comuns |
0x101b6 | (70) | ComSpec=C:\WINDOWS\system32\cmd.exe |
0x10240 | (92) | HOMEPATH=\Documents and Settings\Administrador |
0x102c6 | (44) | NUMBER_OF_PROCESSORS=1 |
0x10424 | (112) | PATHEXT=.COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH |
0x10496 | (52) | PROCESSOR_ARCHITECTURE=x86 |
0x104cc | (134) | PROCESSOR_IDENTIFIER=x86 Family 6 Model 69 Stepping 1, GenuineIntel|
0x10578 | (46) | PROCESSOR_REVISION=4501|
0x105a8 | (74) | ProgramFiles=C:\Arquivos de programas|
0x1063a | (42) | SystemRoot=C:\WINDOWS|
0x10666 | (78) | TEMP=C:\DOCUME~1\ADMINI~1\CONFIG~1\Temp|
0x10726 | (44) | **USERNAME=Administrador**|
0x12fc48 | (40) | **Microsoft Windows XP** |
0x1461d8 | (74) |  \\?\GLOBALROOT\Device\HarddiskVolume1|
0x1604fc | (282) |\\?\IDE#CdRomVBOX_CD-ROM_____________________________1.0_____#42562d3231303037333036372020202020202020#{53f5630d-b6bf-11d0-94f2-00a0c91efb8b}|
0x160618 | (224) | \\?\STORAGE#Volume#1&30a96598&0&SignatureFEE0FEEOffset7E00Length27F4DB200#{53f5630d-b6bf-11d0-94f2-00a0c91efb8b}|
0x17305c | (56) | xplore WWW_GetWindowInfo.exe|
0x1517b0  | (82) | C:\WINDOWS\Registration\R000000000007.clb|
0x151816 | (98) | es locais\Dados de aplicativos\Alo3ky7\COMRes.dll|
0x15c276 | (108) | es locais\Dados de aplicativos\Alo3ky7\FalowDiver0.exe|
